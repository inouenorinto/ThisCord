-- rootユーザーでの実行
CREATE USER 'testuser1'@'localhost' IDENTIFIED BY 'password'
COMMENT 'beginuser by noob';
GRANT USAGE ON *.* TO 'testuser1'@'localhost';
GRANT ALL ON *.* TO 'testuser1'@'localhost';


-- AWS testuser1 
CREATE USER 'testuser1'@'%' IDENTIFIED BY 'password';

GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP, RELOAD, PROCESS, REFERENCES, INDEX, ALTER, SHOW DATABASES, CREATE TEMPORARY TABLES, LOCK TABLES, EXECUTE, REPLICATION SLAVE, REPLICATION CLIENT, CREATE VIEW, SHOW VIEW, CREATE ROUTINE, ALTER ROUTINE, CREATE USER, EVENT, TRIGGER ON *.* TO 'testuser1'@'%' WITH GRANT OPTION;

UNINSTALL PLUGIN validate_password;

FLUSH PRIVILEGE;

mysql -u testuser1 -p -h エンドポイント



-- 実行してもしなくても
SELECT user, host FROM mysql.user;

-- testuser1での実行が好ましい
CREATE DATABASE thiscord;
USE thiscord;

drop table admin_user;
drop table us_relationship;
drop table message;
drop table text_channel;
drop table voice_channel;
drop table server;
drop table account;
drop table friend_relationship;

-- ユーザーの情報
CREATE TABLE account (
    user_id INT AUTO_INCREMENT PRIMARY KEY,
    mailaddress VARCHAR(200),
    password VARCHAR(60),
    user_name VARCHAR(50),
    user_icon VARCHAR(500)
);

-- サーバーの情報
CREATE TABLE server (
    server_id INT AUTO_INCREMENT PRIMARY KEY,
    server_name VARCHAR(100),
    user_id INT,
    server_icon VARCHAR(500),
    FOREIGN KEY (user_id) REFERENCES account(user_id)
);

-- テキストチャンネルのデータ
CREATE TABLE text_channel (
	channel_id INT AUTO_INCREMENT PRIMARY KEY,
	channel_name VARCHAR(50),
	server_id INT,
	FOREIGN KEY (server_id) REFERENCES server(server_id)
);

-- メッセージの履歴
CREATE TABLE message (
	message_id INT AUTO_INCREMENT PRIMARY KEY,
	user_id INT,
	channel_id INT,
	send_date VARCHAR(50),
	message VARCHAR(500),
	FOREIGN KEY (user_id) REFERENCES account(user_id),
	FOREIGN KEY (channel_id) REFERENCES text_channel(channel_id)
);

-- ユーザーがどのサーバーに参加しているか
CREATE TABLE us_relationship (
    user_id INT,
    server_id INT,
    FOREIGN KEY (user_id) REFERENCES account(user_id),
    FOREIGN KEY (server_id) REFERENCES server(server_id)
);

CREATE TABLE voice_channel (
	channel_id INT AUTO_INCREMENT PRIMARY KEY,
	channel_name VARCHAR(50),
	server_id INT,
	FOREIGN KEY (server_id) REFERENCES server(server_id)
);

-- 管理者ユーザーのデータ
CREATE TABLE admin_user (
	user_id INT,
	FOREIGN KEY (user_id) REFERENCES account(user_id)
);

CREATE TABLE friend_relationship (
	user_id1 INT,
	user_id2 INT,
	flag BOOLEAN,
	FOREIGN KEY (user_id1) REFERENCES account(user_id),
	FOREIGN KEY (user_id2) REFERENCES account(user_id)
);

INSERT INTO account (mailaddress, password, user_name, user_icon)
VALUES ('tanaka@gmail.com', '$2a$12$ceg/qdoynIqywpqnwqaewOD16ra21lvILLmJx7i4trAav9bT0Nd7m', 'tanaka', 'default1.png');

INSERT INTO account (mailaddress, password, user_name, user_icon)
VALUES ('ojiisan@gmail.com', '$2a$12$quq.W9rYTGbGUxOV/jZpr.7/opaSv3ZSuXsM.kJisxDqjKyq0nMam', 'ojiisan', 'default2.png');

INSERT INTO account (mailaddress, password, user_name, user_icon)
VALUES ('saigou@gmail.com', '$2a$12$gK.sIMj/1zrkcJ0gQFbojObwfqPiYc5aMafILg7krUBwN1UKyeJiG', 'saigou', 'default3.png');

INSERT INTO server (server_name, user_id, server_icon)
VALUES ('勉強サーバー', 1, 'default');

INSERT INTO server (server_name, user_id, server_icon)
VALUES ('おじいさん', 1, 'default');

INSERT INTO server (server_name, user_id, server_icon)
VALUES ('ゆるゲーム', 1, 'default');

INSERT INTO server (server_name, user_id, server_icon)
VALUES ('APEX', 1, 'default');

INSERT INTO server (server_name, user_id, server_icon)
VALUES ('valorant', 2, 'default');


INSERT INTO us_relationship (user_id, server_id) 
VALUES (1, 1);

INSERT INTO us_relationship (user_id, server_id) 
VALUES (1, 2);

INSERT INTO us_relationship (user_id, server_id) 
VALUES (1, 3);

INSERT INTO us_relationship (user_id, server_id) 
VALUES (1, 4);

INSERT INTO us_relationship (user_id, server_id) 
VALUES (2, 5);

INSERT INTO us_relationship (user_id, server_id) 
VALUES (1, 5);

INSERT INTO us_relationship (user_id, server_id) 
VALUES (2, 1);


INSERT INTO text_channel (channel_name, server_id) 
VALUES ('一般', 1);

INSERT INTO text_channel (channel_name, server_id) 
VALUES ('Java' 1);

INSERT INTO text_channel (channel_name, server_id) 
VALUES ('勉強', 1);

INSERT INTO text_channel (channel_name, server_id) 
VALUES ('ゲーム', 1);

INSERT INTO text_channel (channel_name, server_id) 
VALUES ('一般', 2);

INSERT INTO text_channel (channel_name, server_id) 
VALUES ('一般', 3);

INSERT INTO text_channel (channel_name, server_id) 
VALUES ('一般', 4);

INSERT INTO text_channel (channel_name, server_id) 
VALUES ('一般', 5);



INSERT INTO voice_channel (channel_name, server_id) 
VALUES ('一般', 1);

INSERT INTO voice_channel (channel_name, server_id) 
VALUES ('グループワーク1', 1);

INSERT INTO voice_channel (channel_name, server_id) 
VALUES ('グループワーク2', 1);

INSERT INTO voice_channel (channel_name, server_id) 
VALUES ('グループワーク3', 1);

INSERT INTO voice_channel (channel_name, server_id) 
VALUES ('一般', 2);

INSERT INTO voice_channel (channel_name, server_id) 
VALUES ('一般', 3);

INSERT INTO voice_channel (channel_name, server_id) 
VALUES ('一般', 4);

INSERT INTO voice_channel (channel_name, server_id) 
VALUES ('一般', 5);


INSERT INTO friend_relationship (user_id1, user_id2, flag) 
VALUES (1, 2, true);

INSERT INTO friend_relationship (user_id1, user_id2, flag) 
VALUES (1, 3, true);

INSERT INTO friend_relationship (user_id1, user_id2, flag) 
VALUES (3, 2, true);

commit;