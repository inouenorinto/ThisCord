-- rootユーザーでの実行
CREATE USER 'testuser1'@'localhost' IDENTIFIED BY 'password'
COMMENT 'beginuser by noob';
GRANT USAGE ON *.* TO 'testuser1'@'localhost';
GRANT ALL ON *.* TO 'testuser1'@'localhost';

-- 実行してもしなくても
SELECT user, host FROM mysql.user;

-- testuser1での実行が好ましい
CREATE DATABASE thiscord;
USE thiscord;

drop table user_server_relationship;
drop table text_channel_data;
drop table user_data;
drop table server_data;
drop table message_data;



CREATE TABLE user_data (
    user_id INT AUTO_INCREMENT PRIMARY KEY,
    mailaddress VARCHAR(200),
    password VARCHAR(24),
    user_name VARCHAR(50),
    user_icon VARCHAR(500)
);

CREATE TABLE message_data (
	user_id INT,
	server_id INT,
	channel_id INT,
	send_date VARCHAR(50),
	message VARCHAR(500)
);

CREATE TABLE server_data (
    server_id INT AUTO_INCREMENT PRIMARY KEY,
    server_name VARCHAR(100),
    host_id VARCHAR(20),
    server_icon VARCHAR(500)
);

CREATE TABLE user_server_relationship (
    relationship_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT,
    server_id INT,
    FOREIGN KEY (user_id) REFERENCES user_data(user_id),
    FOREIGN KEY (server_id) REFERENCES server_data(server_id)
);

CREATE TABLE text_channel_data (
	channel_id INT AUTO_INCREMENT PRIMARY KEY,
	channel_name VARCHAR(50),
	server_id INT,
	FOREIGN KEY (server_id) REFERENCES server_data(server_id)
);

INSERT INTO user_data (mailaddress, password, user_name, user_icon)
VALUES ('tanaka@gmail.com', 'tanaka', 'tanaka', 'user_icon_url');

INSERT INTO user_data (mailaddress, password, user_name, user_icon)
VALUES ('ojiisann@gmail.com', 'ojiisan', 'ojiisann', 'user_icon_url');

INSERT INTO user_data (mailaddress, password, user_name, user_icon)
VALUES ('saigou@gmail.com', 'saigou', 'saigou', 'user_icon_url');


INSERT INTO server_data (server_name, host_id, server_icon)
VALUES ('勉強サーバー', 1, 'user_icon_url');

INSERT INTO server_data (server_name, host_id, server_icon)
VALUES ('おじいさん', 1, 'user_icon_url');

INSERT INTO server_data (server_name, host_id, server_icon)
VALUES ('ゆるゲーム', 1, 'user_icon_url');

INSERT INTO server_data (server_name, host_id, server_icon)
VALUES ('APEX', 1, 'user_icon_url');

INSERT INTO server_data (server_name, host_id, server_icon)
VALUES ('valorant', 2, 'user_icon_url');


INSERT INTO user_server_relationship (user_id, server_id) 
VALUES (1, 1);

INSERT INTO user_server_relationship (user_id, server_id) 
VALUES (1, 2);

INSERT INTO user_server_relationship (user_id, server_id) 
VALUES (1, 3);

INSERT INTO user_server_relationship (user_id, server_id) 
VALUES (1, 4);

INSERT INTO user_server_relationship (user_id, server_id) 
VALUES (2, 5);

INSERT INTO user_server_relationship (user_id, server_id) 
VALUES (2, 1);


INSERT INTO text_channel_data (channel_id, server_id) 
VALUES (2, 1);

INSERT INTO text_channel_data (channel_name, server_id) 
VALUES ('勉強', 1);

INSERT INTO text_channel_data (channel_name, server_id) 
VALUES ('ゲーム', 1);



--　複合主キーver
CREATE TABLE server_data (
    discord_server_id VARCHAR(20),
    server_name VARCHAR(100),
    host_id VARCHAR(20),
    server_icon VARCHAR(500),
    server_member_id VARCHAR(20),
    PRIMARY KEY(discord_server_id, server_member_id)
    FOREIGN KEY(server_member_id)
    REFERENCES user_data(discord_user_id)
    ON UPDATE CASCADE ON DELETE RESTRICT
);